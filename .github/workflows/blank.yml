name: ğŸ’€ Klinux-Ultra-Stable

on: 
  workflow_dispatch:

jobs:
  kali-run:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ 1. Khá»Ÿi Ä‘á»™ng & Fix Environment
        run: |
          # Dá»n dáº¹p cÃ¡c tiáº¿n trÃ¬nh apt Ä‘ang cháº¡y ngáº§m Ä‘á»ƒ trÃ¡nh khÃ³a file (Lock error)
          sudo killall apt apt-get || true
          sudo rm -f /var/lib/apt/lists/lock /var/cache/apt/archives/lock /var/lib/dpkg/lock*
          sudo dpkg --configure -a
          
          # Chá»‰ cÃ i nhá»¯ng thá»© tá»‘i thiá»ƒu, dÃ¹ng Docker cÃ³ sáºµn
          sudo apt-get update -q
          sudo apt-get install -y openssh-server -q --no-install-recommends

      - name: ğŸ›¡ï¸ 2. Káº¿t ná»‘i Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          hostname: CyberLexS-Klinux

      - name: ğŸ‘¤ 3. Cáº¥u hÃ¬nh TÃ i khoáº£n
        run: |
          sudo useradd -m -s /bin/bash CyberLexS
          echo "CyberLexS:Nam12345" | sudo chpasswd
          sudo usermod -aG sudo CyberLexS
          # Cho phÃ©p SSH báº±ng máº­t kháº©u
          sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
          sudo service ssh restart

      - name: ğŸ´â€â˜ ï¸ 4. Cháº¡y Klinux (Kali Rolling)
        run: |
          # Kiá»ƒm tra náº¿u Docker chÆ°a cháº¡y thÃ¬ khá»Ÿi Ä‘á»™ng nÃ³
          sudo systemctl start docker || true
          # Cháº¡y Kali Linux
          sudo docker run -d --name klinux --network host -it kalilinux/kali-rolling /bin/bash
          # CÃ i cÃ´ng cá»¥ cÆ¡ báº£n bÃªn trong Kali
          sudo docker exec klinux apt-get update -y
          sudo docker exec klinux apt-get install -y nmap curl iputils-ping -y

      - name: ğŸ“‹ 5. XUáº¤T THÃ”NG TIN (Láº¤Y Táº I ÄÃ‚Y)
        run: |
          IP_ADDR=$(tailscale ip -4)
          echo -e "\n\033[1;32m=========================================="
          echo -e "âœ… VPS ÄÃƒ Sáº´N SÃ€NG - KHÃ”NG Lá»–I"
          echo -e "ğŸ“ IP: $IP_ADDR"
          echo -e "ğŸ‘¤ USER: CyberLexS"
          echo -e "ğŸ”‘ PASS: Nam12345"
          echo -e "âš¡ VÃ€O KALI: sudo docker exec -it klinux /bin/bash"
          echo -e "==========================================\033[0m\n"

      - name: âš“ 6. Treo mÃ¡y (6 Giá»)
        run: sleep 21600
